<!doctype html>
<html>
  <head>
    <title>Eksempelapplikation -- Adgangsplatformen -- login.bib.dk</title>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="./example.js"></script>
    <style>
      body {
        text-align: center;
      }

      label, input {
        width: 100%;
      }

      .bold {
        font-weight: 600;
      }

      #example {
        display: inline-block;
        font-family: "Open Sans", sans-serif;
        text-align: left;
        max-width: 900px;
      }

      .input-pair {
        margin-bottom: 10px;
      }

      .info {
        padding: 10px;
        font-size: 14px;
        margin-top: 5px;
        color: #000000;
        background-color: #f9f9f9;
      }

      .code {
        font-family: monospace;
        white-space: pre;
      }

      .hide {
        display: none;
      }

    </style>
  </head>
  <body>
    <div id="example">
      <h3>Eksempelside -- login.bib.dk</h3>
      <p>Denne side er et eksempel på hvordan kald til login.bib.dk konstrueres og skal ses som en hjælp til udviklere til at komme igang med at udvikle op i mod login.bib.dk</p>
      <p>
        Udfyld felterne herunder, eller brug default værdierne, og klik på login for at teste oplysningerne<br/>
        Under felterne konstrueres URL'en der skal bruges i en applikation for at lave tilsvarende kald til login.bib.dk
      </p>
      <p>
        Efter succesfuldt login på login.bib.dk vil brugeren blive redirected til den URL der er specificeret i Den åbne platform under <span class="code">urls.returnUrl</span>.<br/>
        Hvis eksemplet herunder ikke ændres vil man blive redirected til denne side men med information vedrørende den udstedte ticket i bunden af siden.
      </p>
      <p>
        Et eksempel på hvordan konfigurationen i Den åbne platform kan se ud for en applikation der skal bruge login.bib.dk <a href="https://github.com/DBCDK/hejmdal/blob/master/src/components/Smaug/mock/smaug.client.mock.js">kan ses på GitHub</a> men selve arbejdet med at konfigurerer foretages af DBC.
      </p>
      <p>
        Et token fra Den åbne platform er nødvendigt for at kunne bruge login.bib.dk. Se mere på <a href="https://openplatform.dbc.dk/v1/">https://openplatform.dbc.dk/v1/</a>
      </p>

      <div class="input-pair">
        <label for="input-login-host">Host URL</label>
        <input id="input-login-host" type="text" value="" size="50" disabled oninput="onChange({key: 'host', val: this.value})"/>
      </div>
      <div class="input-pair">
        <label for="input-login-path">Login path</label>
        <input id="input-login-path" type="text" value="" size="50" disabled oninput="onChange({key: 'path', val: this.value})"/>
      </div>

      <div class="input-pair">
        <label for="input-login-token">Token fra Den åbne platform</label><br/>
        <input id="input-login-token" type="text" value="asdfg" size="50" oninput="onChange({key: 'token', val: this.value})"/>
      </div>

      <div class="input-pair">
        <label for="input-preselected-library">Forudvalgt bibliotek der kan ændres af brugeren (valgfri) f.eks. 785100</label><br/>
        <input id="input-preselected-library" type="text" value="" size="50" oninput="onChange({key: 'presel', val: this.value})"/>
      </div>

      <div class="input-pair">
        <label for="input-locked-library">Forudvalgt bibliotek der ikke kan ændres af brugeren (valgfri) f.eks. 785100</label><br/>
        <input id="input-locked-library" type="text" value="" size="50" oninput="onChange({key: 'agency', val: this.value})"/>
      </div>

      <div class="input-pair">
        <label for="input-agency-type">Filtrering af søgbare bibliotekstyper på loginsiden: Alle, Folkebiblioteker eller Forskningsbiblioteker (valgfri). Alle vises som default</label><br/>
        <select id="input-agency-type" name="select" oninput="onChange({key: 'agencytype', val: this.value})">
          <option value="" selected>Alle</option>
          <option value="folk">Folkebiblioteker</option>
          <option value="forsk">Forskningsbiblioteker</option>
        </select>
      </div>

      <div class="input-pair">
        <button id="login-button" onclick="onClick()">Login</button>
        <button id="reset-to-default" onclick="resetToDefault()">Reset (og log ud)</button>
      </div>

      <div class="info">
        <span id="currenturl">&nbsp;</span>
      </div>
      <p>
        Ved successfuldt login vil brugeren, med et redirect, blive sendt tilbage til klienten med to GET parametre sat i URLen - et
        <span class="code">token</span> og et <span class="code">id</span>
        (eks.: <span class="code">?token=TOKEN&id=ID</span>).
        Dette callback konfigureres for den givne applikation i Den åbne platform som beskrevet ovenfor.
      </p>
      <p>
        Ved at indløse <span>token</span> og <span>id</span> på
        <span class="code">/getTicket/TOKEN/ID</span>
        kan applikationen hente de attributter der er aftalt og som brugeren har givet tilladelse til at udveklse.
        Hvilke attributter en applikation kan få udleveret, konfigureres i Den åbne platform.
      </p>

      <div id="post-success" class="hide">
        <div class="info">
          <span class="bold">Token:</span>
          <span id="tickettoken">&nbsp;</span>
        </div>
        <div class="info">
          <span class="bold">ID:</span>
          <span id="ticketid">&nbsp;</span>
        </div>

        <p>
          Med token og id konstrueres en ny URL (<span class="code">/getTicket/TOKEN/ID</span>) som den
          herunder hvorfra den endelige ticket kan hentes.
          Tickets slettes når de er hentet og kan kun hentes en gang. Hvis en ticket ikke hentes efter den er dannet, slettes den automatisk efter kort tid.
        </p>
        <div class="info" id="ticketurl">&nbsp;</div>
        <button id="get-ticket-button" onclick="getTicket()">Hent ticket</button>
        <button id="open-ticket-button" onclick="openTicket()">Åben i nyt vindue</button>
        <div id="ticketcontainer" class="info hide">
          <p class="bold">Ticket:</p>
          <p class="code" id="ticket"></p>
        </div>
      </div>
    </div>
    <script>init()</script>
  </body>
</html>
